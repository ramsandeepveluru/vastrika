<!DOCTYPE html>
<html>
<head>
  <title>Product Details</title>
</head>
<body>

<a href="/">‚Üê Back to Home</a>

<div id="product"></div>

<script>
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

async function loadProduct() {
  const res = await fetch(`/api/products/${id}`);
  const p = await res.json();

  const container = document.getElementById("product");

  container.innerHTML = `
    <h2>${p.name}</h2>
    <p>‚Çπ ${p.price}</p>
    <p>${p.description}</p>
    <button onclick="addToCart(${p.id})">Add to Cart üõí</button>
  `;
}

async function addToCart(productId) {
  const token = localStorage.getItem("token");

  if (!token) {
    alert("Please login first");
    window.location.href = "/login.html";
    return;
  }

  const res = await fetch("/api/cart", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: token
    },
    body: JSON.stringify({
      product_id: productId,
      quantity: 1
    })
  });

  const data = await res.json();

  if (res.ok) {
    alert("Added to cart ‚úÖ");
  } else {
    alert(data.message);
  }
}

loadProduct();
</script>

</body>
</html>
